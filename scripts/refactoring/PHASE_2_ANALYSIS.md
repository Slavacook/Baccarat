# Phase 2: Ğ”ĞµĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ UIManager

**Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°**: 2025-12-04
**Ğ’ĞµÑ‚ĞºĞ°**: `refactoring/phase-2-uimanager`
**Ğ¦ĞµĞ»ÑŒ**: Ğ Ğ°Ğ·Ğ±Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ½Ğ¾Ğ»Ğ¸Ñ‚Ğ½Ñ‹Ğ¹ UIManager (325 ÑÑ‚Ñ€Ğ¾Ğº, 23 Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ°) Ğ½Ğ° 5 ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²

---

## ğŸ“Š Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ UIManager

**Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°**:
- **Ğ Ğ°Ğ·Ğ¼ĞµÑ€**: 325 ÑÑ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ°
- **ĞœĞµÑ‚Ğ¾Ğ´Ğ¾Ğ²**: 23
- **ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…**: 30+ (UI ÑƒĞ·Ğ»Ñ‹)
- **Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²**: 6

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹**:
- âŒ God Object (ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ĞµĞ¹)
- âŒ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚ Ğ²ÑĞµÑ… UI ÑƒĞ·Ğ»Ğ¾Ğ²)
- âŒ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑÑ‚ÑŒ (Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»)
- âŒ ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ Single Responsibility Principle

---

## ğŸ¯ ĞŸĞ»Ğ°Ğ½ Ğ´ĞµĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸: 5 Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²

### 1. CardUIManager (ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ¸ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸)
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€**: ~150 ÑÑ‚Ñ€Ğ¾Ğº
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼Ğ¸ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ¸ Ğ±Ğ°Ğ½ĞºĞ¸Ñ€Ğ°, Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ğ´Ğ°Ñ‡Ğ¸

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹** (8):
```gdscript
- show_first_four_cards(player_hand, banker_hand)
- show_player_third_card(card)
- show_banker_third_card(card)
- reset_cards()
- _hide_all_cards()
- _show_initial_backs()
- set_flip_cards(cards)
- set_main_node(node)
```

**UI ÑƒĞ·Ğ»Ñ‹**:
- player_card1, player_card2, player_card3
- banker_card1, banker_card2, banker_card3
- flip_cards (Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¹)
- main_node (Ğ´Ğ»Ñ await)

---

### 2. ToggleUIManager (Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚Ñ€ĞµÑ‚ÑŒĞ¸Ñ… ĞºĞ°Ñ€Ñ‚)
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€**: ~80 ÑÑ‚Ñ€Ğ¾Ğº
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ toggles (? â†” !) Ğ´Ğ»Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ° Ñ‚Ñ€ĞµÑ‚ÑŒĞ¸Ñ… ĞºĞ°Ñ€Ñ‚

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹** (4):
```gdscript
- update_player_third_card_ui(state, card)
- update_banker_third_card_ui(state, card)
- _on_player_toggle_input(event)
- _on_banker_toggle_input(event)
```

**Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹** (2):
- player_third_toggled(selected: bool)
- banker_third_toggled(selected: bool)

**UI ÑƒĞ·Ğ»Ñ‹**:
- player_third_toggle (TextureRect)
- banker_third_toggle (TextureRect)

---

### 3. ButtonUIManager (ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹)
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€**: ~60 ÑÑ‚Ñ€Ğ¾Ğº
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ (action_button, help, lang)

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹** (5):
```gdscript
- update_action_button(text)
- set_action_button_state(state)  # start/confirm/complete
- enable_action_button()
- disable_action_button()
- update_lang_button()
```

**Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹** (2):
- action_button_pressed()
- help_button_pressed()
- lang_button_pressed()

**UI ÑƒĞ·Ğ»Ñ‹**:
- action_button (TextureButton)
- help_button (Button)
- lang_button (Button)

---

### 4. MarkerUIManager (Ğ¼Ğ°Ñ€ĞºĞµÑ€Ñ‹ Ğ¿Ğ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»Ñ)
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€**: ~50 ÑÑ‚Ñ€Ğ¾Ğº
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ°Ğ¼Ğ¸ Player/Banker/Tie (ÑĞµĞ¹Ñ‡Ğ°Ñ Ñ‡ĞµÑ€ĞµĞ· WinnerSelectionManager)

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹** (1):
```gdscript
- connect_winner_button(button, winner)  # DEPRECATED Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸
```

**Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹** (1):
- winner_selected(winner: String)

**UI ÑƒĞ·Ğ»Ñ‹**:
- player_marker (Control)
- banker_marker (Control)
- tie_marker (Control)

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ**: Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ WinnerSelectionManager, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ€ĞµÑˆĞ¸Ñ‚ÑŒ:
- ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ MarkerUIManager ĞºĞ°Ğº Ñ‚Ğ¾Ğ½ĞºÑƒÑ Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºÑƒ Ğ½Ğ°Ğ´ WinnerSelectionManager
- Ğ˜Ğ»Ğ¸ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ

---

### 5. PayoutToggleManager (Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚)
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€**: ~60 ÑÑ‚Ñ€Ğ¾Ğº
**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ toggles Ğ´Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ/Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹** (4):
```gdscript
- _on_payout_player_toggled(enabled)
- _on_payout_banker_toggled(enabled)
- _on_payout_tie_toggled(enabled)
- _update_payout_toggle_style(button, enabled, color)
```

**UI ÑƒĞ·Ğ»Ñ‹**:
- payout_toggle_player (Button)
- payout_toggle_banker (Button)
- payout_toggle_tie (Button)

---

## ğŸ—ï¸ ĞĞ¾Ğ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° UIManager

### UIManager ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑÑ Facade (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ‚Ğ¾Ñ€)

```gdscript
class_name UIManager
extends RefCounted

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var card_ui: CardUIManager
var toggle_ui: ToggleUIManager
var button_ui: ButtonUIManager
var marker_ui: MarkerUIManager
var payout_toggle_ui: PayoutToggleManager

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ (Ğ¿Ñ€Ğ¾Ğ±Ñ€Ğ¾Ñ Ğ¾Ñ‚ Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

signal action_button_pressed()
signal player_third_toggled(selected: bool)
signal banker_third_toggled(selected: bool)
signal winner_selected(winner: String)
signal help_button_pressed()
signal lang_button_pressed()

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞšĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€ (Dependency Injection)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func _init(scene: Node, card_manager: CardTextureManager):
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹
    card_ui = CardUIManager.new(scene, card_manager)
    toggle_ui = ToggleUIManager.new(scene, card_manager)
    button_ui = ButtonUIManager.new(scene)
    marker_ui = MarkerUIManager.new(scene)
    payout_toggle_ui = PayoutToggleManager.new(scene)

    # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ÑÑ Ğ½Ğ° ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²
    button_ui.action_button_pressed.connect(
        func(): action_button_pressed.emit()
    )
    toggle_ui.player_third_toggled.connect(
        func(selected): player_third_toggled.emit(selected)
    )
    # ... Ğ¸ Ñ‚.Ğ´.

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞœĞµÑ‚Ğ¾Ğ´Ñ‹-Ğ´ĞµĞ»ĞµĞ³Ğ°Ñ‚Ñ‹ (Ğ¿Ñ€Ğ¾Ğ±Ñ€Ğ¾Ñ Ğº Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°Ğ¼)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func show_first_four_cards(player_hand, banker_hand):
    card_ui.show_first_four_cards(player_hand, banker_hand)

func update_player_third_card_ui(state, card = null):
    toggle_ui.update_player_third_card_ui(state, card)

func set_action_button_state(state):
    button_ui.set_action_button_state(state)

# ... Ğ¸ Ñ‚.Ğ´. Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ²
```

---

## ğŸ“‹ ĞŸĞ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ

### Ğ¨Ğ°Ğ³ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ CardUIManager âœ…
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `scripts/ui/CardUIManager.gd`
2. ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ĞºĞ°Ñ€Ñ‚ Ğ¸ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¹
3. ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ (mock UI ÑƒĞ·Ğ»Ñ‹)

### Ğ¨Ğ°Ğ³ 2: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ToggleUIManager âœ…
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `scripts/ui/ToggleUIManager.gd`
2. ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ toggles Ñ‚Ñ€ĞµÑ‚ÑŒĞ¸Ñ… ĞºĞ°Ñ€Ñ‚
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ player_third_toggled, banker_third_toggled

### Ğ¨Ğ°Ğ³ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ButtonUIManager âœ…
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `scripts/ui/ButtonUIManager.gd`
2. ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ action_button_pressed, help_button_pressed, lang_button_pressed

### Ğ¨Ğ°Ğ³ 4: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ MarkerUIManager âœ…
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `scripts/ui/MarkerUIManager.gd`
2. ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¾Ğ² (Ğ¸Ğ»Ğ¸ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºÑƒ Ğ½Ğ°Ğ´ WinnerSelectionManager)
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ» winner_selected

### Ğ¨Ğ°Ğ³ 5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ PayoutToggleManager âœ…
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `scripts/ui/PayoutToggleManager.gd`
2. ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚
3. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ PayoutSettingsManager

### Ğ¨Ğ°Ğ³ 6: Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ UIManager â†’ Facade âœ…
1. Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ²ĞµÑÑŒ ĞºĞ¾Ğ´ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ², Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´ĞµĞ»ĞµĞ³Ğ°Ñ‚Ñ‹
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ğµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹ Ğ² ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€Ğµ
3. ĞŸÑ€Ğ¾Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ Ğ¾Ñ‚ Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²

### Ğ¨Ğ°Ğ³ 7: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ñ… ĞºĞ»Ğ°ÑÑĞ¾Ğ² âœ…
1. GameController - Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ UIManager ĞºĞ°Ğº Ñ„Ğ°ÑĞ°Ğ´)
2. GamePhaseManager - Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ UIManager ĞºĞ°Ğº Ñ„Ğ°ÑĞ°Ğ´)
3. Ğ¢ĞµÑÑ‚Ñ‹ - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²

---

## âœ… ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ°

1. **Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ĞµĞ¹**:
   - âœ… ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° Ğ¾Ğ´Ğ½Ñƒ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ UI
   - âœ… UIManager < 100 ÑÑ‚Ñ€Ğ¾Ğº (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´ĞµĞ»ĞµĞ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

2. **ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ**:
   - âœ… ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ API UIManager Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ
   - âœ… GameController Ğ¸ GamePhaseManager Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

3. **Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ**:
   - âœ… ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾
   - âœ… ĞœĞ¾ĞºĞ¸ ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ñ‹ (Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¼Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ UI ÑƒĞ·Ğ»Ñ‹)

4. **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ**:
   - âœ… ĞĞµÑ‚ Ñ€ĞµĞ³Ñ€ĞµÑÑĞ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
   - âœ… ĞĞµÑ‚ ÑƒÑ‚ĞµÑ‡ĞµĞº Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸

5. **Ğ˜Ğ³Ñ€Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚**:
   - âœ… ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
   - âœ… Ğ’ÑĞµ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹

---

## ğŸ“Š ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

| Ğ¤Ğ°Ğ¹Ğ» | Ğ‘Ñ‹Ğ»Ğ¾ | Ğ¡Ñ‚Ğ°Ğ»Ğ¾ | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ |
|------|------|-------|-----------|
| UIManager.gd | 325 ÑÑ‚Ñ€Ğ¾Ğº | ~80 ÑÑ‚Ñ€Ğ¾Ğº | -245 ÑÑ‚Ñ€Ğ¾Ğº âœ… |
| CardUIManager.gd | - | ~150 ÑÑ‚Ñ€Ğ¾Ğº | +150 ÑÑ‚Ñ€Ğ¾Ğº |
| ToggleUIManager.gd | - | ~80 ÑÑ‚Ñ€Ğ¾Ğº | +80 ÑÑ‚Ñ€Ğ¾Ğº |
| ButtonUIManager.gd | - | ~60 ÑÑ‚Ñ€Ğ¾Ğº | +60 ÑÑ‚Ñ€Ğ¾Ğº |
| MarkerUIManager.gd | - | ~50 ÑÑ‚Ñ€Ğ¾Ğº | +50 ÑÑ‚Ñ€Ğ¾Ğº |
| PayoutToggleManager.gd | - | ~60 ÑÑ‚Ñ€Ğ¾Ğº | +60 ÑÑ‚Ñ€Ğ¾Ğº |
| **Ğ˜Ğ¢ĞĞ“Ğ** | **325 ÑÑ‚Ñ€Ğ¾Ğº** | **~500 ÑÑ‚Ñ€Ğ¾Ğº** | **+175 ÑÑ‚Ñ€Ğ¾Ğº** |

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ**: Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ° - ÑÑ‚Ğ¾ **Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾**!
ĞœÑ‹ Ğ½Ğµ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€, Ğ¼Ñ‹ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ **ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ** Ğ¸ **Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ**.

---

## ğŸš§ Ğ Ğ¸ÑĞºĞ¸ Ğ¸ Ğ¼Ğ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ

### Ğ Ğ¸ÑĞº 1: Ğ¡Ğ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ñ‹
**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ**: Ğ¢ĞµÑÑ‚Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ MockUI, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²

### Ğ Ğ¸ÑĞº 2: ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ 5 Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 1)
**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ**: Ğ’ÑĞµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹ RefCounted, ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ² ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€Ğµ UIManager

### Ğ Ğ¸ÑĞº 3: Ğ£ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ ĞºĞ¾Ğ´Ñƒ
**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ**: Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ, Ñ‡Ñ‘Ñ‚ĞºĞ¸Ğµ Ğ¸Ğ¼ĞµĞ½Ğ° Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ², IDE Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾

---

## ğŸ“ Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

1. **Ğ’ÑĞµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹ - RefCounted** (Ğ½Ğµ Node), ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
2. **Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ Ğ¿Ñ€Ğ¾Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ** Ñ‡ĞµÑ€ĞµĞ· UIManager (Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Observer)
3. **UI ÑƒĞ·Ğ»Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· get_node()** Ğ² ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€Ğ°Ñ… Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ²
4. **Null-safety**: Ğ²ÑĞµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ UI ÑƒĞ·Ğ»Ğ¾Ğ² (Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
5. **CardTextureManager** Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ² CardUIManager Ğ¸ ToggleUIManager (Ğ´Ğ»Ñ Ñ‚ĞµĞºÑÑ‚ÑƒÑ€ Ñ€ÑƒĞ±Ğ°ÑˆĞµĞº)

---

**ĞĞ²Ñ‚Ğ¾Ñ€**: Claude Code
**Ğ”Ğ°Ñ‚Ğ°**: 2025-12-04
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: ğŸš§ Ğ’ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ
