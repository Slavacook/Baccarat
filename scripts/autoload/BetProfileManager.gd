# res://scripts/autoload/BetProfileManager.gd
# Autoload ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑĞ¼Ğ¸ ÑÑ‚Ğ°Ğ²Ğ¾Ğº
# ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñƒ ÑÑ‚Ğ°Ğ²Ğ¾Ğº (Ğ¼Ğ°Ğ»Ñ‹Ğµ/ÑÑ€ĞµĞ´Ğ½Ğ¸Ğµ/ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ)

extends Node

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞšĞĞĞ¡Ğ¢ĞĞĞ¢Ğ« - ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ˜ Ğ¡Ğ¢ĞĞ’ĞĞš
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum BetProfile {
	SMALL,   # ĞœĞ°Ğ»Ñ‹Ğµ ÑÑ‚Ğ°Ğ²ĞºĞ¸ (Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ¾Ğ²)
	MEDIUM,  # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ²ĞºĞ¸ (Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°)
	LARGE    # ĞšÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ ÑÑ‚Ğ°Ğ²ĞºĞ¸ (VIP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚)
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¤Ğ˜ĞšĞ¡Ğ˜Ğ ĞĞ’ĞĞĞĞ«Ğ• Ğ”Ğ˜ĞĞŸĞĞ—ĞĞĞ« Ğ¡Ğ¢ĞĞ’ĞĞš
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: [[min, max, chance%], ...]
# ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚Ñ‹: [70, 22, 7.5, 0.5] = Ñ‡Ğ°Ñ‰Ğµ/Ñ€ĞµĞ¶Ğµ/Ñ€ĞµĞ´ĞºĞ¾/Ğ½ĞµĞ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾

const BET_RANGES = {
	"classic": {
		"small_main": [[50, 150, 70], [151, 400, 22], [401, 700, 7.5], [701, 2000, 0.5]],
		"small_tie": [[25, 50, 70], [51, 70, 22], [71, 100, 7.5], [101, 150, 0.5]],
		"small_pair": [[25, 100, 70], [101, 300, 22], [301, 600, 7.5], [601, 900, 0.5]],

		"medium_main": [[50, 700, 70], [701, 1000, 22], [1001, 1500, 7.5], [1501, 3000, 0.5]],
		"medium_tie": [[100, 300, 70], [301, 600, 22], [601, 900, 7.5], [901, 1000, 0.5]],
		"medium_pair": [[25, 300, 70], [301, 500, 22], [501, 700, 7.5], [701, 900, 0.5]],

		"large_main": [[200, 700, 70], [701, 1200, 22], [1201, 2000, 7.5], [2001, 3000, 0.5]],
		"large_tie": [[100, 500, 70], [501, 700, 22], [701, 900, 7.5], [901, 1000, 0.5]],
		"large_pair": [[100, 400, 70], [401, 600, 22], [601, 800, 7.5], [801, 900, 0.5]]
	},
	"junket": {
		"small_main": [[2000, 10000, 70], [10500, 30000, 22], [30500, 45000, 7.5], [45500, 90000, 0.5]],
		"small_tie": [[100, 200, 70], [200, 300, 22], [300, 400, 7.5], [400, 500, 0.5]],
		"small_pair": [[100, 1000, 70], [1100, 3000, 22], [3100, 7000, 7.5], [7100, 15000, 0.5]],

		"medium_main": [[2000, 20000, 70], [20500, 50000, 22], [50500, 70000, 7.5], [150000, 200000, 0.5]],
		"medium_tie": [[100, 300, 70], [300, 600, 22], [600, 900, 7.5], [900, 1000, 0.5]],
		"medium_pair": [[100, 3000, 70], [3100, 7000, 22], [7100, 10000, 7.5], [10100, 15000, 0.5]],

		"large_main": [[30000, 70000, 70], [70500, 120000, 22], [120500, 200000, 7.5], [2000, 10000, 0.5]],
		"large_tie": [[200, 400, 70], [400, 700, 22], [700, 900, 7.5], [900, 1000, 0.5]],
		"large_pair": [[1000, 5000, 70], [5100, 9000, 22], [9100, 12000, 7.5], [12100, 15000, 0.5]]
	}
}

# Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğµ ÑˆĞ°Ğ½ÑÑ‹ (Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ, Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ´Ğ»Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
const PROFILE_CHANCES = {
	BetProfile.SMALL: {
		"main": [70, 22, 7.5, 0.5],
		"tie": [70, 22, 7.5, 0.5],
		"name_ru": "ĞœĞ°Ğ»Ñ‹Ğµ",
		"name_en": "Small",
		"description_ru": "ĞœĞµĞ»ĞºĞ¸Ğµ ÑÑ‚Ğ°Ğ²ĞºĞ¸ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸",
		"description_en": "Small bets for practice"
	},
	BetProfile.MEDIUM: {
		"main": [70, 22, 7.5, 0.5],
		"tie": [70, 22, 7.5, 0.5],
		"name_ru": "Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğµ",
		"name_en": "Medium",
		"description_ru": "Ğ ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°",
		"description_en": "Realistic gameplay"
	},
	BetProfile.LARGE: {
		"main": [70, 22, 7.5, 0.5],
		"tie": [70, 22, 7.5, 0.5],
		"name_ru": "ĞšÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ",
		"name_en": "Large",
		"description_ru": "Ğ˜Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¾Ğ³Ğ°Ñ‚Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°",
		"description_en": "High roller simulation"
	}
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ«
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

signal profile_changed(profile: BetProfile)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞŸĞ•Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ•
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var current_profile: BetProfile = BetProfile.MEDIUM

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func _ready():
	_load_profile()
	print("ğŸ’° BetProfileManager Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½: Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ = %s" % get_profile_name())

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞŸĞ£Ğ‘Ğ›Ğ˜Ğ§ĞĞ«Ğ• ĞœĞ•Ğ¢ĞĞ”Ğ«
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â† Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
func set_profile(profile: BetProfile) -> void:
	current_profile = profile
	profile_changed.emit(profile)
	SaveManager.save_bet_profile(profile)
	print("ğŸ’° ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑÑ‚Ğ°Ğ²Ğ¾Ğº Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½: %s" % get_profile_name())

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
func get_profile() -> BetProfile:
	return current_profile

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑˆĞ°Ğ½ÑÑ‹ Ğ´Ğ»Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑÑ‚Ğ°Ğ²Ğ¾Ğº (Player/Banker)
func get_main_chances() -> Array:
	return PROFILE_CHANCES[current_profile]["main"]

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑˆĞ°Ğ½ÑÑ‹ Ğ´Ğ»Ñ TIE ÑÑ‚Ğ°Ğ²Ğ¾Ğº
func get_tie_chances() -> Array:
	return PROFILE_CHANCES[current_profile]["tie"]

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ (Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ)
func get_profile_name(lang: String = "") -> String:
	if lang == "":
		lang = Localization.get_lang()
	var key = "name_ru" if lang == "ru" else "name_en"
	return PROFILE_CHANCES[current_profile][key]

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ (Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ)
func get_profile_description(lang: String = "") -> String:
	if lang == "":
		lang = Localization.get_lang()
	var key = "description_ru" if lang == "ru" else "description_en"
	return PROFILE_CHANCES[current_profile][key]

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¿Ğ¾ enum
func get_profile_name_by_enum(profile: BetProfile, lang: String = "") -> String:
	if lang == "":
		lang = Localization.get_lang()
	var key = "name_ru" if lang == "ru" else "name_en"
	return PROFILE_CHANCES[profile][key]

# â† Ğ¦Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ (Ğ´Ğ»Ñ UI ĞºĞ½Ğ¾Ğ¿ĞºĞ¸)
func cycle_profile() -> void:
	match current_profile:
		BetProfile.SMALL:
			set_profile(BetProfile.MEDIUM)
		BetProfile.MEDIUM:
			set_profile(BetProfile.LARGE)
		BetProfile.LARGE:
			set_profile(BetProfile.SMALL)

# â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ
func get_ranges(mode: String, bet_type: String) -> Array:
	var profile_name = ""
	match current_profile:
		BetProfile.SMALL:
			profile_name = "small"
		BetProfile.MEDIUM:
			profile_name = "medium"
		BetProfile.LARGE:
			profile_name = "large"

	var key = profile_name + "_" + bet_type  # "small_main", "medium_tie", etc.
	return BET_RANGES[mode][key]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞŸĞ Ğ˜Ğ’ĞĞ¢ĞĞ«Ğ• ĞœĞ•Ğ¢ĞĞ”Ğ«
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

func _load_profile() -> void:
	var saved = SaveManager.load_bet_profile()
	if saved >= 0 and saved <= 2:
		current_profile = saved as BetProfile
	else:
		current_profile = BetProfile.MEDIUM
